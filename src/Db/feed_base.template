record(longout, "$(PREF)Debug-SP") {
    field(DTYP, "FEED Debug")
    field(DESC, "Debug print mask")
    field(OUT , "@name=$(NAME)")
    field(VAL , "$(DEBUG=0)")
    field(PINI, "YES")
    info(autosaveFields_pass0, "VAL")
}

record(bo, "$(PREF)Rst-Cmd") {
    field(DESC, "Force re-connect")
    field(ZNAM, "Reset")
    field(ONAM, "Reset")
    field(UDF , "0")
    field(FLNK, "$(PREF)Addr-SP") # setting address always forces reset
}

record(stringout, "$(PREF)Addr-SP") {
    field(DTYP, "FEED Set Address")
    field(DESC, "Set Device IP address")
    field(OUT , "@name=$(NAME)")
    field(VAL , "$(ADDR=)")
    field(PINI, "YES")
    info(autosaveFields_pass0, "VAL")
}

record(mbbi, "$(PREF)State-Sts") {
    field(DTYP, "FEED State")
    field(INP , "@name=$(NAME)")
    field(SCAN, "I/O Intr")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(TWVL, "2")
    field(THVL, "3")
    field(FRVL, "4")
    field(ZRST, "Error")
    field(ONST, "Idle")
    field(TWST, "Searching")
    field(THST, "Inspecting")
    field(FRST, "Running")
    field(ZRSV, "MAJOR")
    field(ONSV, "")
    field(TWSV, "MAJOR")
    field(THSV, "MINOR")
    field(FRSV, "")
}

record(aai, "$(PREF)LastError-I") {
    field(DTYP, "FEED Error")
    field(INP , "@name=$(NAME)")
    field(SCAN, "I/O Intr")
    field(NELM, "256")
}

record(longin, "$(PREF)CntTx-I") {
    field(DTYP, "FEED Counter")
    field(INP , "@name=$(NAME) offset=0")
    field(SCAN, "1 second") # also adjust *Rate* CALC when changing
    field(FLNK, "$(PREF)RateTx-I")
}
record(calc, "$(PREF)RateTx-I") {
    field(INPA, "$(PREF)CntTx-I")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "pkt/s")
    field(FLNK, "$(PREF)CntRx-I")
}
record(longin, "$(PREF)CntRx-I") {
    field(DTYP, "FEED Counter")
    field(INP , "@name=$(NAME) offset=1")
    field(FLNK, "$(PREF)RateTx-I")
}
record(calc, "$(PREF)RateRx-I") {
    field(INPA, "$(PREF)CntRx-I")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "pkt/s")
    field(FLNK, "$(PREF)CntIgnore-I")
}
record(longin, "$(PREF)CntIgnore-I") {
    field(DTYP, "FEED Counter")
    field(INP , "@name=$(NAME) offset=2")
    field(FLNK, "$(PREF)RateTx-I")
}
record(calc, "$(PREF)RateIgnore-I") {
    field(INPA, "$(PREF)CntIgnore-I")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "pkt/s")
    field(FLNK, "$(PREF)CntTimo-I")
}
record(longin, "$(PREF)CntTimo-I") {
    field(DTYP, "FEED Counter")
    field(INP , "@name=$(NAME) offset=3")
    field(FLNK, "$(PREF)RateTx-I")
}
record(calc, "$(PREF)RateTimo-I") {
    field(INPA, "$(PREF)CntTimo-I")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "pkt/s")
    field(FLNK, "$(PREF)CntErr-I")
}
record(longin, "$(PREF)CntErr-I") {
    field(DTYP, "FEED Counter")
    field(INP , "@name=$(NAME) offset=4")
    field(FLNK, "$(PREF)RateTx-I")
}
record(calc, "$(PREF)RateErr-I") {
    field(INPA, "$(PREF)CntErr-I")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "pkt/s")
}

record(aai, "$(PREF)ROM-I") {
    field(DTYP, "FEED Register Read")
    field(INP , "@name=$(NAME) reg=ROM")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(NELM, "2048")
}

# Background poll to ensure the device is still there
record(longin, "$(PREF)Hello-I") {
    field(DTYP, "FEED Register Read")
    field(INP , "@name=$(NAME) reg=HELLO")
    field(SCAN, "2 second")
}
